# 仕様書: 1-3 標準ブロックエディタ

## 1. 概要

標準ブロック（shape_type="normal"）を編集するシンプルな Webベースのエディタを作る。
細かな項目編集はここでは行わず、テクスチャ設定だけを作る。
細かな項目編集や新規作成・削除などは、別の管理ツールで行うのでここでは考慮しない。

ここで作る重要な部品は、
・GAS API の読み書きライブラリ（ゲーム本体、管理ツールで利用）
・通常ブロックのメッシュ生成ライブラリ（ゲーム本体で利用）
・通常ブロックのテクスチャ編集UI（管理ツールで利用）

src/test/ 及び src/game/ のディレクトリは公開用の Github リポジトリにプッシュする
公開用リポジトリ: https://github.com/masaru0ta/craftgame_public

## 2. 関連資料

- spec_1-1_block_data_sheet.md: データ構造
- spec_1-2_gas_api.md: API仕様

## 3. 機能詳細

### 3.1 画面構成

- ２カラム。比率 4:6
- 左カラムに block_id 選択のプルダウン、block_str_id（表示のみ）、name（表示のみ）、保存ボタンを表示
- 右カラムに 3Dプレビュー兼編集。領域のアスペクト比は 横:縦 = 2:3（やや縦長の領域）

### 3.2 3Dプレビュー レイアウト

- Three.jsを使用して 3Dプレビューを表示
- 上部1/6に黒い帯（ツールボタン枠）を表示
- ツールボタン枠右端に背景色切り換えボタン（BG）を表示
- BGボタンの内部は現在の背景色で塗りつぶす
- BGボタンは下部のテクスチャ枠と同じ大きさにする
- 床面となる高さにブロックと同じ大きさの白い枠線と、その枠線の外側に FRONT, RIGHT, LEFT, BACK をテキスト表示
- 各面に指定されたテクスチャを表示
- 初期表示でFRONTが正面になる
- 初期表示で垂直角度20度（少し上から見下ろす）
- 初期表示でカメラ距離3（ブロックサイズの3倍）
- 3Dプレビュー枠内の下部に、7つのテクスチャ画像とラベルを表示
- ラベルは default, top, bottom, front, left, right, back
- テクスチャ未設定の面は default の指定があれば default のテクスチャを使用する。テクスチャ画像枠は未設定状態のまま。

### 3.3 3Dプレビュー 操作

- 背景色切り換えボタンクリックで背景色が変化する（グレー → 青 → 緑 → 黒 → グレー）
- 背景色変更時にBGボタン内部の色も更新される
- マウスドラッグで視点を回転させる。左右回転と上下の傾き変更が可能。
- 上下の傾きは上側90度下側90度まで。マウスを右にドラッグすると、ブロックが右に回転する。
- マウスのホイールスクロールで拡大縮小

### 3.4 テクスチャ選択

- テクスチャ枠をクリックするとテクスチャの選択画面を表示
- テクスチャ選択画面ではテクスチャをタイル表示
- タイルの最初に「テクスチャなし」があり、それをクリックするとテクスチャ選択が未設定状態になる
- タイルの最後に「テクスチャ追加」があり、それをクリックするとテクスチャをローカルからアップロードする
- アップロードしたテクスチャは、APIを通じてスプレッドシートに保存される

### 3.5 レスポンシブ対応

- ウィンドウ幅が狭くなって 3Dプレビュー枠が小さくなってもブロックとテクスチャ枠のサイズを自動調整する

## 4. ファイル構成

```
src/
  test/
    spec_1-3_standard_block_editor.html       # メインHTML
    spec_1-3_standard_block_editor_style.css  # スタイル
    spec_1-3_standard_block_editor_main.js    # メインスクリプト
  game/
    standard_block_editor.js                  # 通常ブロック用エディターUI
    gas_api.js                                # API通信
    standard_block_mesh_builder.js            # 通常ブロック用メッシュ生成
```

## 5. テスト項目

### 画面表示
- [ ] Github にパブリッシュしたエディタ画面が正常に表示される
- [ ] 4:6 の比率で2カラム表示されている
- [ ] 左カラムにblock_id選択プルダウンが表示される
- [ ] 左カラムにblock_str_id、name、保存ボタンが表示される
- [ ] 右カラムに3Dプレビューが表示される
- [ ] 3Dプレビュー下部に7つのテクスチャ枠とラベルが表示される

### 3Dプレビュー レイアウト
- [ ] 表示領域のアスペクト比が 横:縦 = 2:3（やや縦長の領域）になっている
- [ ] 上部1/6に黒い帯（ツールボタン枠）が表示される
- [ ] ツールボタン枠右端に背景色切り換えボタン（BG）が表示される
- [ ] BGボタンの内部が現在の背景色で塗りつぶされている
- [ ] BGボタンが下部のテクスチャ枠と同じ大きさである
- [ ] 床面にブロックと同じ大きさの白い枠線が表示される
- [ ] 床面の高さにFRONT, RIGHT, LEFT, BACKのテキストが表示されている
- [ ] 立方体が表示される
- [ ] 初期表示でFRONTが正面になっている
- [ ] 初期表示で垂直角度20度（少し上から見下ろす）になっている
- [ ] 初期表示でカメラ距離3（ブロックサイズの3倍）になっている
- [ ] 各面にテクスチャが正しく表示される
- [ ] テクスチャ未設定の面はdefaultテクスチャが使用される（テクスチャ枠は未設定状態のまま）

### 3Dプレビュー 操作
- [ ] 背景色切り換えボタンクリックで背景色が変化する（グレー → 青 → 緑 → 黒 → グレー）
- [ ] 背景色変更時にBGボタン内部の色も更新される
- [ ] マウスドラッグで視点を回転できる
- [ ] 上下の傾きが上側90度、下側90度までに制限される
- [ ] マウスホイールで拡大縮小できる

### テクスチャ選択
- [ ] テクスチャ枠が 3Dプレビューの枠の中の最下部に表示されている
- [ ] テクスチャ指定が未選択の場合は黒で表示されているか
- [ ] テクスチャ枠クリックで選択画面が表示される
- [ ] テクスチャがタイル表示される
- [ ] 「テクスチャなし」選択で未設定状態になる
- [ ] 「テクスチャ追加」でローカルファイルをアップロードできる
- [ ] アップロードしたテクスチャがスプレッドシートに保存される
- [ ] テクスチャ変更時に3Dプレビューが更新される

### データ読込
- [ ] 起動時にGAS APIからブロック一覧を取得できる
- [ ] 起動時にGAS APIからテクスチャ一覧を取得できる
- [ ] ブロック選択時にblock_str_id、nameが表示される
- [ ] ブロック選択時にテクスチャ設定が反映される

### データ保存
- [ ] 保存ボタンでGAS APIにデータを送信できる
- [ ] 保存後にブロック一覧が更新される
