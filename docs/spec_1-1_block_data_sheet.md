# 仕様書: 1-1 ブロックデータシート

## 1. 概要

ボクセルゲームで使用するブロック定義データを管理するGoogleスプレッドシート。
全てのブロック情報をブロック一覧シートで統合管理し、テクスチャ情報はテクスチャ一覧シートで管理する。

## 2. 関連資料

- spec_list.md: 機能一覧
- スプレッドシートURL: https://docs.google.com/spreadsheets/d/1opkXxb8BRxQKGD7WKwbEvElWfd9UvIvx8wIDdm36GiM/edit?gid=0#gid=0

## 3. 機能詳細

### 3.1 スプレッドシート構成

スプレッドシートは以下の2つのシートで構成される。

| シート名         | 用途                                       |
| --------------- | ------------------------------------------ |
| ブロック状態     | 全てのブロック状態の定義（通常・カスタム両方） |
| テクスチャ       | 使用可能なテクスチャファイルの管理            |

### 3.2 ブロック状態シート

全てのブロック（通常ブロック・カスタムブロック）を統合管理する。

| 列名            | 型     | 必須 | 説明                                             |
| --------------- | ------ | --- | ------------------------------------------------ |
| block_id        | 数値   | ○   | ブロックの一意識別子（0〜）。ワールドデータ保存用   |
| block_str_id    | 文字列 | ○   | 文字列形式の識別子（例: stone, dirt）。コード参照用 |
| name            | 文字列 | ○   | ブロックの表示名                                  |
| shape_type      | 文字列 | ○   | "normal"（通常）または "custom"（カスタム）       |
| is_transparent  | 真偽値 | -   | 透過ブロックかどうか。ライトマップに影響。省略=false |
| light_level     | 数値   | -   | 発光レベル（0-15）。省略=0                        |
| drop_item       | 文字列 | -   | 破壊時ドロップアイテムID。省略=自身をドロップ       |
| tex_default     | 文字列 | ※1 | デフォルトテクスチャファイル名（全面に適用）        |
| tex_top         | 文字列 | -   | 上面のテクスチャファイル名。拡張子含まず。省略=tex_default       |
| tex_bottom      | 文字列 | -   | 下面、同上                                       |
| tex_front       | 文字列 | -   | 前面、同上                                       |
| tex_back        | 文字列 | -   | 背面、同上                                       |
| tex_left        | 文字列 | -   | 左側面、同上                                      |
| tex_right       | 文字列 | -   | 右側面、同上                                      |
| voxel_look      | 文字列 | ※2 | 見た目用ボクセルデータ（8x8x8, 2bit）               |
| voxel_collision | 文字列 | ※2 | 当たり判定用ボクセルデータ（4x4x4, 1bit）           |
| material_1      | 文字列 | ※2 | カスタムブロック用マテリアル1のテクスチャファイル名 |
| material_2      | 文字列 | -   | カスタムブロック用マテリアル2のテクスチャファイル名 |
| material_3      | 文字列 | -   | カスタムブロック用マテリアル3のテクスチャファイル名 |

※1: shape_type="normal"の場合は必須
※2: shape_type="custom"の場合は必須

#### 3.2.1 通常ブロック（shape_type="normal"）

通常の立方体（1x1x1）ブロック。tex_default を基本とし、面ごとに異なるテクスチャを指定可能。

#### 3.2.2 カスタムブロック（shape_type="custom"）

独自形状を持つブロック。見た目は8x8x8ボクセル、当たり判定は4x4x4ボクセルで表現。

##### voxel_look形式

8x8x8のボクセルデータをBase64エンコード。
各ボクセルは2ビット（0-3）で表現され、material_1〜3へのインデックスを示す。
- 0: 空気（透明）
- 1: material_1
- 2: material_2
- 3: material_3

データはY→Z→X順で格納される。

##### voxel_collision形式

4x4x4の当たり判定データをBase64エンコード。
各ボクセルは1ビットで表現される。
- 0: 通過可
- 1: 衝突あり

データはY→Z→X順で格納される。

### 3.3 テクスチャ一覧シート

使用可能なテクスチャファイルを管理する。

| 列名         | 型     | 必須 | 説明                                |
| ------------ | ----- | ---- | ----------------------------------- |
| texture_id   | 数値   | ○   | 一意のテクスチャ番号（0～）            |
| file_name    | 文字列 | ○   | テクスチャファイル名（拡張子を含む） |
| color_hex    | 文字列 | -   | 代表色（マップ表示用、#RRGGBB形式） |
| image_base64 | 文字列 | -   | Base64エンコードされた画像データ     |

## 4. 考慮事項・制限事項

- スプレッドシートはGoogleスプレッドシートを使用する
- データの編集はブロック管理ツール経由で行う
- block_id（数値）はブロック状態シート内で一意である必要がある
- block_str_id（文字列）はブロック状態シート内で一意である必要がある
- ワールドデータ保存時はblock_id（数値）を使用する
- コード内でのブロック参照にはblock_str_id（文字列）を使用する
- texture_idはテクスチャシート内で一意である必要がある
- テクスチャファイルはファイル名で指定する（拡張子を含まず）
- カスタムブロックで使用できるマテリアルは最大3種類

## 5. テスト項目

### スプレッドシート構造

- [ ] スプレッドシートが作成されている
- [ ]「ブロック状態」シートが存在する
- [ ]「テクスチャ」シートが存在する

### ブロック状態シート

- [ ] 設計にある列がすべて存在する

### テクスチャ一覧シート

- [ ] 設計にある列がすべて存在する
